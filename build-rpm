#!/bin/bash
set -ETeu -o pipefail

# base build number on git commit counts
build_number=$(git rev-list HEAD | wc -l)

rpmbuild -bb ${WORKSPACE}/mmdb-vmod.spec --define "_build_number ${build_number}" --define "_source ${WORKSPACE}"
for e in $(find ~/rpmbuild/RPMS -name mmdb-vmod\*.rpm); do
    /usr/bin/sign-rpm $e
    /usr/bin/publish-rpm $e
    rm -f $e
done
